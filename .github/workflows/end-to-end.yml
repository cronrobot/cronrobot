name: End-to-end

on:
  push:


jobs:
  end-to-end:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.8' # Version range or exact version of a Python version to use, using SemVer's version range syntax
          architecture: 'x64'
      -
        name: boot
        env:
          FERNET_SECRET_KEY: ${{secrets.FERNET_SECRET_KEY_TEST}}
        run: |
          echo "PYTHONUNBUFFERED=1" > .env
          echo "FERNET_SECRET_KEY=$FERNET_SECRET_KEY" >> .env
          cat .env
          docker-compose up -d
          sleep 20
      -
        name: Api OK
        env:
          API_BASE_URL: http://localhost:8000/api
        run: |
          bash tests/e2e/api_ok.sh

      - name: API /periodic-tasks
        env:
          API_BASE_URL: http://localhost:8000/api
        run: |
          bash tests/e2e/api_periodic_tasks.sh

      - name: API /resources
        env:
          API_BASE_URL: http://localhost:8000/api
        run: |
          bash tests/e2e/api_resources.sh

