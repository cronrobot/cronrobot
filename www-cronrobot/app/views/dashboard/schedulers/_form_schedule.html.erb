<fieldset>
    <legend class="sub-heading">Schedule</legend>
    <div class="form-grid">
        <%= form.select "params[schedule_type]",
            friendly_schedule_lister, { selected: @scheduler&.params&.dig("schedule_type") || "every_5_minutes" },
            multiple: false,
            onchange: "handleScheduleTypeChange(this.value)",
            oninit: "alert('hello')",
            class: "select-input" %>
                
        <div id="customScheduleBlock">
            <%= form.text_field :schedule, class: "form-input", id: "schedule_field", placeholder: "Custom Schedule (Crontab format)" %>
        </div>
    </div>
</fieldset>

<script>
    function getSchedules() {
        return <%= friendly_schedules.to_json.html_safe %>
    }

    (function() {
        window.formHide("customScheduleBlock")
        window.formShow("customScheduleBlock")

        let scheduleType = document.getElementById("scheduler_http_params[schedule_type]")
        handleScheduleTypeChange(scheduleType)
    })();

    function handleScheduleTypeChange(value) {
        const schedules = getSchedules()

        if (value === "custom") {
            window.formShow("customScheduleBlock")
        } else {
            window.formHide("customScheduleBlock")

            const schedule = schedules.find(s => s["id"] === value)
            const scheduleTextField = document.getElementById("schedule_field")

            if (schedule) {
                scheduleTextField.value = schedule["cron"]
            } else {
                scheduleTextField.value = "every_5_minutes"
            }
        }
    }
</script>